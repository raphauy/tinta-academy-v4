[
  {
    "id": "6.01",
    "category": "schema",
    "description": "Add Order model for purchase transactions",
    "steps": [
      "Create Order model in prisma/schema.prisma with fields:",
      "  - id: String @id @default(cuid())",
      "  - orderNumber: String @unique (format: TA-YYYYMMDD-XXXX)",
      "  - userId: String (relation to User)",
      "  - courseId: String (relation to Course)",
      "  - studentId: String? (optional, linked after payment confirmed)",
      "  - couponId: String? (optional)",
      "  - originalPriceUSD: Float",
      "  - originalPriceUYU: Float?",
      "  - discountPercent: Float @default(0)",
      "  - discountAmount: Float @default(0)",
      "  - finalAmount: Float",
      "  - currency: Currency @default(USD)",
      "  - paymentMethod: PaymentMethod",
      "  - status: OrderStatus @default(created)",
      "  - mpPreferenceId: String? (MercadoPago preference ID)",
      "  - mpPaymentId: String? (MercadoPago payment ID)",
      "  - mpStatus: String? (MercadoPago status)",
      "  - mpStatusDetail: String? (MercadoPago status detail)",
      "  - bankAccountId: String? (for bank transfers)",
      "  - transferReference: String? (user reference/comment)",
      "  - createdAt, updatedAt, paidAt, cancelledAt, refundedAt: DateTime fields",
      "Add indexes: userId, courseId, status, paymentMethod, orderNumber, mpPreferenceId, mpPaymentId",
      "Add relations: user, course, student?, coupon?, bankAccount?",
      "Run prisma generate (do NOT run migrate yet, will migrate after all schema changes)",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": true
  },
  {
    "id": "6.02",
    "category": "schema",
    "description": "Add BankAccount model for manual transfer payments",
    "steps": [
      "Create BankAccount model in prisma/schema.prisma with fields:",
      "  - id: String @id @default(cuid())",
      "  - bankName: String",
      "  - accountHolder: String (titular de la cuenta)",
      "  - accountType: String (Caja de ahorro, Cuenta corriente, etc)",
      "  - accountNumber: String",
      "  - currency: Currency",
      "  - swiftCode: String? (for international transfers)",
      "  - routingNumber: String?",
      "  - displayOrder: Int @default(0)",
      "  - notes: String? (internal notes)",
      "  - isActive: Boolean @default(true)",
      "  - createdAt, updatedAt: DateTime fields",
      "Add relation: orders Order[]",
      "Add indexes: currency, isActive",
      "Run prisma generate",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": true
  },
  {
    "id": "6.03",
    "category": "schema",
    "description": "Add Coupon model for discount codes",
    "steps": [
      "Create Coupon model in prisma/schema.prisma with fields:",
      "  - id: String @id @default(cuid())",
      "  - code: String @unique",
      "  - discountPercent: Float (0-100)",
      "  - maxUses: Int @default(1)",
      "  - currentUses: Int @default(0)",
      "  - restrictedToEmail: String? (if set, only this email can use)",
      "  - restrictedToCourseId: String? (if set, only for this course)",
      "  - minPurchaseAmount: Float? (minimum purchase amount)",
      "  - validFrom: DateTime @default(now())",
      "  - expiresAt: DateTime?",
      "  - isActive: Boolean @default(true)",
      "  - description: String? (internal description)",
      "  - createdBy: String? (admin user ID)",
      "  - createdAt, updatedAt: DateTime fields",
      "Add relations: orders Order[], restrictedToCourse Course?",
      "Add indexes: code, isActive, expiresAt, restrictedToEmail",
      "Run prisma generate",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.04",
    "category": "schema",
    "description": "Add enums and update existing models for checkout",
    "steps": [
      "Add enums to prisma/schema.prisma:",
      "  - OrderStatus: created, pending_payment, payment_processing, paid, cancelled, refunded, rejected",
      "  - PaymentMethod: mercadopago, bank_transfer, free",
      "  - Currency: USD, UYU",
      "Add priceUYU: Float? field to Course model",
      "Add orders: Order[] relation to User model",
      "Add orders: Order[] relation to Student model",
      "Add orders: Order[] relation to Course model",
      "Add coupons: Coupon[] relation to Course model (for restricted coupons)",
      "Run prisma generate",
      "Run prisma migrate dev --name add_checkout_models",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.05",
    "category": "data",
    "description": "Create migration script for BankData and Coupons from v3",
    "steps": [
      "Create scripts/migrate-checkout-data.ts script that:",
      "  - Connects to v3 database (MongoDB or PostgreSQL depending on v3 setup)",
      "  - Reads all BankData records from v3",
      "  - Maps v3 BankData to v4 BankAccount model (name->bankName, info->parse fields)",
      "  - Reads all active Coupons from v3 (where uses < maxUses and not expired)",
      "  - Maps v3 Coupon to v4 Coupon model (same field names mostly)",
      "  - For restrictedToCourseId: need to map v3 courseId to v4 courseId (by slug or manual)",
      "  - Inserts records into v4 database",
      "  - Logs migration results",
      "Add script to package.json: migrate:checkout",
      "Document manual steps needed (course ID mapping)",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.06",
    "category": "api",
    "description": "Create order-service for order management",
    "steps": [
      "Create src/services/order-service.ts with:",
      "Types:",
      "  - CreateOrderInput: userId, courseId, paymentMethod, currency, couponCode?",
      "  - OrderWithRelations: Order with user, course, student?, coupon?, bankAccount?",
      "Queries:",
      "  - getOrderById(id): OrderWithRelations | null",
      "  - getOrderByNumber(orderNumber): OrderWithRelations | null",
      "  - getOrdersByUserId(userId): OrderWithRelations[]",
      "  - getOrdersByStatus(status): OrderWithRelations[]",
      "  - getOrderByMpPreferenceId(preferenceId): Order | null",
      "  - getOrderByMpPaymentId(paymentId): Order | null",
      "  - getPendingTransferOrders(): OrderWithRelations[]",
      "Mutations:",
      "  - createOrder(input): creates order, generates orderNumber, calculates prices",
      "  - updateOrderStatus(orderId, status, metadata?): updates status and optional fields",
      "  - setMercadoPagoPreference(orderId, preferenceId): saves MP preference ID",
      "  - cancelOrder(orderId): sets status to cancelled",
      "  - markTransferAsSent(orderId, reference?, proofUrl?): for user marking transfer sent",
      "Helper: generateOrderNumber() - format TA-YYYYMMDD-XXXX",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.07",
    "category": "api",
    "description": "Create coupon-service for discount validation",
    "steps": [
      "Create src/services/coupon-service.ts with:",
      "Types:",
      "  - ValidateCouponResult: { valid, coupon?, error?, discountPercent?, discountAmount?, finalAmount? }",
      "  - CouponError: 'not_found' | 'expired' | 'exhausted' | 'invalid_email' | 'invalid_course' | 'min_amount' | 'inactive'",
      "Queries:",
      "  - getCouponByCode(code): Coupon | null",
      "  - getCouponById(id): Coupon | null",
      "  - getAllCoupons(): Coupon[]",
      "  - getActiveCoupons(): Coupon[] (isActive=true, not expired, uses < maxUses)",
      "Validation:",
      "  - validateCoupon(code, userEmail, courseId, originalAmount): ValidateCouponResult",
      "    - Check coupon exists and is active",
      "    - Check not expired (expiresAt)",
      "    - Check uses < maxUses",
      "    - Check restrictedToEmail matches if set",
      "    - Check restrictedToCourseId matches if set",
      "    - Check minPurchaseAmount if set",
      "    - Calculate discountAmount and finalAmount",
      "Mutations:",
      "  - incrementCouponUsage(couponId): increments currentUses by 1",
      "  - createCoupon(input): admin creation",
      "  - updateCoupon(id, input): admin update",
      "  - deactivateCoupon(id): sets isActive=false",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.08",
    "category": "api",
    "description": "Create bank-account-service for transfer payment data",
    "steps": [
      "Create src/services/bank-account-service.ts with:",
      "Queries:",
      "  - getBankAccountById(id): BankAccount | null",
      "  - getAllBankAccounts(): BankAccount[]",
      "  - getActiveBankAccounts(): BankAccount[] (isActive=true, ordered by displayOrder)",
      "  - getBankAccountsByCurrency(currency): BankAccount[]",
      "Mutations:",
      "  - createBankAccount(input): admin creation",
      "  - updateBankAccount(id, input): admin update",
      "  - toggleBankAccountStatus(id): toggle isActive",
      "  - deleteBankAccount(id): soft delete or hard delete if no orders",
      "  - reorderBankAccounts(orderedIds): update displayOrder for all",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.09",
    "category": "api",
    "description": "Create mercadopago-service for payment gateway integration",
    "steps": [
      "Install mercadopago package: pnpm add mercadopago",
      "Add environment variables to .env.example:",
      "  - MERCADOPAGO_ACCESS_TOKEN",
      "  - MERCADOPAGO_PUBLIC_KEY",
      "  - MERCADOPAGO_WEBHOOK_SECRET",
      "Create src/services/mercadopago-service.ts with:",
      "Config:",
      "  - Initialize MercadoPagoConfig with accessToken from env",
      "Types:",
      "  - CreatePreferenceInput: order, course, user, successUrl, failureUrl, pendingUrl, webhookUrl",
      "  - PaymentInfo: id, status, statusDetail, externalReference, preferenceId, transactionAmount",
      "Functions:",
      "  - createPreference(input): creates MP preference, returns preferenceId and initPoint URL",
      "    - items: course title, quantity 1, unit_price in UYU",
      "    - external_reference: order.id",
      "    - metadata: { orderId: order.id }",
      "    - back_urls: success, failure, pending",
      "    - notification_url: webhook URL",
      "  - getPayment(paymentId): fetches payment details from MP API",
      "  - verifyPaymentStatus(paymentId): returns status, statusDetail, orderId",
      "  - validateWebhookSignature(payload, signature, requestId): HMAC validation",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.10",
    "category": "api",
    "description": "Create checkout-service for checkout flow orchestration",
    "steps": [
      "Create src/services/checkout-service.ts with:",
      "Types:",
      "  - CheckoutContext: user, course, coupon?, bankAccounts, pricing, canEnroll, enrollmentBlockReason?",
      "  - Pricing: originalPriceUSD, originalPriceUYU, discountPercent, discountAmountUSD, discountAmountUYU, finalPriceUSD, finalPriceUYU, isFree",
      "  - EnrollmentBlockReason: 'already_enrolled' | 'course_full' | 'course_closed' | 'deadline_passed'",
      "Functions:",
      "  - getCheckoutContext(userId, courseId, couponCode?): CheckoutContext",
      "    - Fetch user, course, validate enrollment eligibility",
      "    - Validate coupon if provided",
      "    - Get active bank accounts",
      "    - Calculate all pricing variations",
      "  - initiateCheckout(userId, courseId, paymentMethod, currency, couponCode?): Order",
      "    - Create order in 'created' status",
      "    - Apply coupon discount if valid",
      "  - processCheckoutMercadoPago(orderId): { order, redirectUrl }",
      "    - Create MP preference",
      "    - Update order with preferenceId",
      "    - Return initPoint URL",
      "  - processCheckoutBankTransfer(orderId, bankAccountId): Order",
      "    - Update order with bank account selection",
      "    - Set status to pending_payment",
      "  - processFreeEnrollment(userId, courseId, couponCode?): { order, enrollment }",
      "    - Create order with paymentMethod=free, status=paid",
      "    - Create student if needed, enrollment, assign role",
      "  - completeCheckout(orderId): { order, enrollment, isNewStudent }",
      "    - Transaction: update order to paid, create student if needed, create enrollment, assign role, increment coupon usage",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.11",
    "category": "actions",
    "description": "Create server actions for checkout operations",
    "steps": [
      "Create src/app/checkout/actions.ts with 'use server'",
      "Helper: getAuthenticatedUser() - get user from session, return error if not logged in",
      "Actions:",
      "  - getCheckoutContextAction(courseId, couponCode?): CheckoutContext or error",
      "  - applyCouponAction(courseId, couponCode): ValidateCouponResult",
      "  - initiateCheckoutAction(courseId, paymentMethod, currency, couponCode?): { orderId, redirectUrl? } or error",
      "    - For mercadopago: returns redirectUrl to MP",
      "    - For bank_transfer: returns orderId only",
      "    - For free: completes immediately, returns orderId",
      "  - markTransferSentAction(orderId, reference?): success or error",
      "  - getOrderStatusAction(orderId): order status and details or error",
      "All actions must verify user is authenticated",
      "Use Zod for input validation",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.12",
    "category": "actions",
    "description": "Create server actions for admin order management",
    "steps": [
      "Create src/app/admin/orders/actions.ts with 'use server'",
      "Helper: requireAdmin() - verify user has admin role",
      "Actions:",
      "  - getOrdersAction(filters?): paginated list of orders",
      "  - getOrderDetailAction(orderId): full order details",
      "  - confirmTransferPaymentAction(orderId): confirms bank transfer, completes checkout",
      "  - cancelOrderAction(orderId): cancels order",
      "  - refundOrderAction(orderId): refunds order, cancels enrollment",
      "All actions require admin role",
      "Use revalidatePath after mutations",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.13",
    "category": "page",
    "description": "Create checkout page for course purchase",
    "steps": [
      "Create src/app/checkout/[courseId]/page.tsx as RSC",
      "Get session, redirect to /login?returnUrl=/checkout/[courseId] if not authenticated",
      "Fetch checkout context using getCheckoutContext",
      "If canEnroll=false, render CannotEnrollPage with reason",
      "If pricing.isFree, render FreeCheckout component",
      "Otherwise render CheckoutForm component",
      "Add metadata: title 'Checkout - Tinta Academy'",
      "Create src/app/checkout/layout.tsx with minimal layout (no sidebar, centered content)",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.14",
    "category": "page",
    "description": "Create checkout success page",
    "steps": [
      "Create src/app/checkout/success/[orderId]/page.tsx as RSC",
      "Fetch order by ID, verify user owns the order",
      "If order not found or not paid, redirect to /student",
      "Detect if course is WSET type and student profile is incomplete",
      "Render SuccessPage component with:",
      "  - Confetti effect on mount",
      "  - Order confirmation details (course, amount, method)",
      "  - If WSET and incomplete profile: prominent banner to complete data",
      "  - CTA buttons: 'Ir a mi curso', 'Completar mis datos' (if needed)",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.15",
    "category": "page",
    "description": "Create checkout pending page for bank transfers",
    "steps": [
      "Create src/app/checkout/pending/[orderId]/page.tsx as RSC",
      "Fetch order by ID, verify user owns the order",
      "If order not found or status is not pending_payment, redirect appropriately",
      "Fetch bank accounts for display",
      "Render PendingTransferPage component with:",
      "  - Order summary (course, amount in USD)",
      "  - Bank account details with copy buttons",
      "  - Instructions for transfer",
      "  - Form to mark transfer as sent with optional reference field",
      "  - After marking sent: show confirmation message with next steps",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.16",
    "category": "api",
    "description": "Create MercadoPago webhook endpoint",
    "steps": [
      "Create src/app/api/webhooks/mercadopago/route.ts",
      "Export POST handler:",
      "  - Get headers: x-signature, x-request-id",
      "  - Get body as text",
      "  - Validate signature using validateWebhookSignature",
      "  - Return 401 if invalid signature",
      "  - Parse payload JSON",
      "  - If type !== 'payment', return { received: true }",
      "  - Fetch payment details from MP using getPayment",
      "  - Find order by mpPaymentId or mpPreferenceId",
      "  - Process based on payment.status:",
      "    - approved: call completeCheckout, send confirmation email",
      "    - rejected: update order status to rejected, send rejection email",
      "    - pending/in_process: update order status to payment_processing",
      "    - cancelled: update order status to cancelled",
      "  - Return 200 with processing result",
      "  - Log all webhook activity for debugging",
      "Add error handling that returns 200 to prevent MP retries on internal errors",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.17",
    "category": "ui",
    "description": "Create checkout form component",
    "steps": [
      "Create src/components/checkout/checkout-form.tsx as client component",
      "Props: context (CheckoutContext)",
      "State: paymentMethod, currency, couponCode, isLoading, appliedCoupon",
      "Layout: 2-column grid on desktop (form left, summary right), stacked on mobile",
      "Sections:",
      "  - CouponInput component at top",
      "  - PaymentMethodSelector component",
      "  - If bank_transfer selected: BankAccountDisplay component",
      "  - Submit button with dynamic text based on method and price",
      "Handle form submission:",
      "  - Call initiateCheckoutAction",
      "  - If redirectUrl returned (MP): redirect to MP",
      "  - If no redirectUrl (transfer): redirect to /checkout/pending/[orderId]",
      "Show loading states during submission",
      "Handle errors with toast notifications",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.18",
    "category": "ui",
    "description": "Create checkout summary component",
    "steps": [
      "Create src/components/checkout/checkout-summary.tsx",
      "Props: course, pricing, coupon?",
      "Display:",
      "  - Course image (if available)",
      "  - Course title and type badge",
      "  - Educator name",
      "  - Price breakdown:",
      "    - Original price (show in selected currency)",
      "    - Discount line if coupon applied (strikethrough original, show discount %)",
      "    - Final price prominently displayed",
      "  - Course details: start date, modality, location (if presencial)",
      "Use Card component with subtle background",
      "Sticky on desktop (position: sticky)",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.19",
    "category": "ui",
    "description": "Create payment method selector component",
    "steps": [
      "Create src/components/checkout/payment-method-selector.tsx as client component",
      "Props: selected, onSelect, pricing, onCurrencyChange",
      "Display two selectable cards:",
      "  - MercadoPago option:",
      "    - MP logo/icon",
      "    - Title: 'MercadoPago'",
      "    - Description: 'Tarjeta de credito, debito o efectivo'",
      "    - Price in UYU",
      "  - Bank Transfer option:",
      "    - Bank icon",
      "    - Title: 'Transferencia Bancaria'",
      "    - Description: 'Pago en dolares via transferencia'",
      "    - Price in USD",
      "On selection:",
      "  - Update selected state",
      "  - Update currency accordingly (UYU for MP, USD for transfer)",
      "Use radio-group pattern with custom styled cards",
      "Show checkmark on selected option",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.20",
    "category": "ui",
    "description": "Create coupon input component",
    "steps": [
      "Create src/components/checkout/coupon-input.tsx as client component",
      "Props: onApply (callback), appliedCoupon?, isLoading?",
      "State: couponCode, validationError, isValidating",
      "Display:",
      "  - Collapsible section 'Tengo un cupon de descuento'",
      "  - When expanded: input field + 'Aplicar' button",
      "  - If coupon applied: show success badge with code and discount %, X button to remove",
      "  - If error: show error message below input",
      "On apply:",
      "  - Call applyCouponAction",
      "  - If valid: call onApply callback with coupon data",
      "  - If invalid: show specific error message",
      "Transform input to uppercase automatically",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.21",
    "category": "ui",
    "description": "Create free checkout and success components",
    "steps": [
      "Create src/components/checkout/free-checkout.tsx",
      "Props: context (CheckoutContext)",
      "Display:",
      "  - Course summary (title, image, details)",
      "  - 'Este curso es gratuito' message",
      "  - If coupon applied: show 'Descuento aplicado: 100%'",
      "  - Single 'Inscribirme ahora' button",
      "On click:",
      "  - Call initiateCheckoutAction with paymentMethod='free'",
      "  - Show loading state",
      "  - On success: redirect to success page",
      "Create src/components/checkout/success-page.tsx",
      "Props: order, showDataBanner",
      "Display:",
      "  - Confetti effect (use react-confetti or similar)",
      "  - Success icon and message",
      "  - Order details card",
      "  - If showDataBanner: prominent WSET data completion CTA",
      "  - Navigation buttons",
      "Create src/components/checkout/cannot-enroll.tsx for blocked enrollments",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.22",
    "category": "feature",
    "description": "Implement checkout email notifications",
    "steps": [
      "Create email templates in src/components/emails/:",
      "  - order-confirmation.tsx: purchase confirmation with order details",
      "  - transfer-instructions.tsx: bank account details for transfer",
      "  - transfer-confirmed.tsx: sent when admin confirms transfer",
      "  - payment-rejected.tsx: sent when MP rejects payment",
      "  - wset-data-reminder.tsx: reminder to complete WSET data",
      "Add functions to src/services/email-service.ts:",
      "  - sendOrderConfirmationEmail(order): sends confirmation",
      "  - sendTransferInstructionsEmail(order, bankAccounts): sends bank details",
      "  - sendTransferConfirmedEmail(order): sends after admin confirmation",
      "  - sendPaymentRejectedEmail(order, reason): sends rejection notice",
      "  - sendWsetDataReminderEmail(student, course): reminder for WSET courses",
      "Call appropriate email functions from checkout-service and webhook handler",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.23",
    "category": "feature",
    "description": "Add checkout button to course detail page",
    "steps": [
      "Update src/components/course-detail/course-detail-page.tsx or similar component:",
      "  - Add 'Inscribirse' button in course header/CTA area",
      "  - Show price prominently near button",
      "  - If user is logged in and already enrolled: show 'Ya estas inscrito' with link to course",
      "  - If course is full: show 'Curso lleno' disabled state",
      "  - If deadline passed: show 'Inscripciones cerradas'",
      "Create src/components/course-detail/enrollment-cta.tsx component:",
      "  - Handle all states: available, enrolled, full, closed",
      "  - Show price in USD (primary) and UYU (secondary)",
      "  - Link button to /checkout/[courseId]",
      "Ensure button works for non-logged-in users (will redirect to login then back)",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.24",
    "category": "polish",
    "description": "Add loading skeletons and error states to checkout",
    "steps": [
      "Create src/components/checkout/skeletons.tsx with:",
      "  - CheckoutFormSkeleton (payment options + summary)",
      "  - CheckoutSummarySkeleton",
      "  - SuccessPageSkeleton",
      "Add Suspense boundaries in checkout pages",
      "Create error.tsx files for checkout routes:",
      "  - src/app/checkout/[courseId]/error.tsx",
      "  - src/app/checkout/success/[orderId]/error.tsx",
      "  - src/app/checkout/pending/[orderId]/error.tsx",
      "Handle common errors gracefully:",
      "  - Course not found",
      "  - Order not found",
      "  - Payment gateway timeout",
      "  - Network errors",
      "Add retry functionality where appropriate",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  },
  {
    "id": "6.25",
    "category": "integration",
    "description": "End-to-end checkout testing and verification",
    "steps": [
      "Manual testing checklist:",
      "  1. Create test bank account via database or migration",
      "  2. Create test coupon (100% discount for testing free flow)",
      "  3. Test free course enrollment (price=0)",
      "  4. Test course with 100% coupon (becomes free)",
      "  5. Test MercadoPago flow in sandbox mode:",
      "     - Verify preference creation",
      "     - Complete test payment in MP sandbox",
      "     - Verify webhook receives notification",
      "     - Verify order status updates correctly",
      "     - Verify enrollment is created",
      "  6. Test bank transfer flow:",
      "     - Initiate checkout with transfer",
      "     - Verify bank account display",
      "     - Mark transfer as sent",
      "     - Admin confirms transfer",
      "     - Verify enrollment is created",
      "  7. Verify email notifications are sent",
      "  8. Verify student role is assigned on first purchase",
      "  9. Test coupon restrictions (email, course, expiry)",
      "  10. Test already-enrolled prevention",
      "Document any issues found and fix them",
      "Verify with pnpm lint, pnpm typecheck, pnpm build in sequence"
    ],
    "passes": false
  }
]
